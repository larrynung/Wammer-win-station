(function(){define(["eventbundler"],function(e){var t;return t=function(){function t(){}return t.TYPE_ALL=0,t.TYPE_PHOTO=1,t.TYPE_MUSIC=2,t.TYPE_VIDEO=4,t.TYPE_DOC=8,t.prototype.type=t.TYPE_PHOTO,t.prototype.callAttachments=function(t,n,r,i,s){var o,u;return t==null&&(t=!1),n==null&&(n=200),r==null&&(r="all"),u={page_size:n,type:this.type},new e("GetAttachments",r),!t||(u.post_id_array=t),!!i&&!!s&&(dispatch.off("store:change:"+this.schemaName+":"+r),dispatch.off("render:change:"+this.schemaName+":"+r),dispatch.on("render:change:"+this.schemaName+":"+r,i,s),dispatch.on("store:change:"+this.schemaName+":"+r,this.updateAttachment,this)),o={namespace:r,type:this.schemaName},wfwsocket.sendMessage("getAttachments",u,o)},t.prototype.updateAttachment=function(e,t){var n,r=this;n=e.attachments;if(n.length<=0)return!1;_.each(n,function(e,t){return r.setDateGroup(e,t),r.add(e)}),this.dateGroup=_.uniq(this.dateGroup);if(t!=="all")return dispatch.trigger("render:change:"+this.schemaName+":"+t,n)},t.prototype.setDateGroup=function(e,t){var n;return n=moment(e.timestamp).format("YYYY-MM-DD"),this.dateGroup.push(n)},t.prototype.filterByDate=function(e){return e?_(this.filter(function(t){var n;return n=t.get("dateUri"),n===e})):this},t.prototype.nextDate=function(e){var t;return t=_.indexOf(this.dateGroup,e),this.dateGroup[t-1]},t.prototype.previousDate=function(e){var t;return t=_.indexOf(this.dateGroup,e),this.dateGroup[t+3]||dispatch.trigger("more:"+this.schemaName+":bylength"),this.dateGroup[t+1]},t}()})}).call(this);