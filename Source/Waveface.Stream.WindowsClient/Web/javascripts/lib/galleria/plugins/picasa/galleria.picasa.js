/**
 * Galleria Picasa Plugin 2012-04-04
 * http://galleria.io
 *
 * Licensed under the MIT license
 * https://raw.github.com/aino/galleria/master/LICENSE
 *
 */
(function(e){Galleria.requires(1.25,"The Picasa Plugin requires Galleria version 1.2.5 or later.");var t=Galleria.utils.getScriptPath();Galleria.Picasa=function(){this.options={max:30,imageSize:"medium",thumbSize:"thumb",complete:function(){}}},Galleria.Picasa.prototype={constructor:Galleria.Picasa,search:function(e,t){return this._call("search","all",{q:e},t)},user:function(e,t){return this._call("user","user/"+e,t)},useralbum:function(e,t,n){return this._call("useralbum","user/"+e+"/album/"+t,n)},setOptions:function(t){return e.extend(this.options,t),this},_call:function(t,n,r,i){n="https://picasaweb.google.com/data/feed/api/"+n+"?",typeof r=="function"&&(i=r,r={});var s=this;r=e.extend({kind:"photo",access:"public","max-results":this.options.max,thumbsize:this._getSizes().join(","),alt:"json-in-script",callback:"?"},r),e.each(r,function(e,t){n+="&"+e+"="+t});var o=!1;return Galleria.utils.wait({until:function(){return o},success:function(){s._parse.call(s,o.feed.entry,i)},error:function(){var e="";t=="user"?e="user not found.":t=="useralbum"&&(e="album or user not found."),Galleria.raise("Picasa request failed"+(e?": "+e:"."))},timeout:5e3}),e.getJSON(n,function(e){o=e}),s},_getSizes:function(){var t=this,n={small:"72c",thumb:"104u",medium:"640u",big:"1024u",original:"1600u"},r=t.options,i={},s,o=[32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600];return e(["thumbSize","imageSize"]).each(function(){r[this]in n?i[this]=n[r[this]]:(s=Galleria.utils.parseValue(r[this]),s>1600?s=1600:e.each(o,function(e){if(s<this)return s=o[e-1],!1}),i[this]=s)}),[i.thumbSize,i.imageSize,"1280u"]},_parse:function(t,n){var r=this,i=[],s;e.each(t,function(){s=this.media$group.media$thumbnail,i.push({thumb:s[0].url,image:s[1].url,big:s[2].url,title:this.summary.$t})}),n.call(this,i)}};var n=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||typeof this._options.picasa!="string"){n.apply(this,Galleria.utils.array(arguments));return}var r=this,i=Galleria.utils.array(arguments),s=this._options.picasa.split(":"),o,u=e.extend({},r._options.picasaOptions),a=typeof u.loader!="undefined"?u.loader:e("<div>").css({width:48,height:48,opacity:.7,background:"#000 url("+t+"loader.gif) no-repeat 50% 50%"});if(s.length){if(typeof Galleria.Picasa.prototype[s[0]]!="function")return Galleria.raise(s[0]+" method not found in Picasa plugin"),n.apply(this,i);if(!s[1])return Galleria.raise("No picasa argument found"),n.apply(this,i);window.setTimeout(function(){r.$("target").append(a)},100),o=new Galleria.Picasa,typeof r._options.picasaOptions=="object"&&o.setOptions(r._options.picasaOptions);var f=[];if(s[0]=="useralbum"){f=s[1].split("/");if(f.length!=2){Galleria.raise("Picasa useralbum not correctly formatted (should be [user]/[album])");return}}else f.push(s[1]);f.push(function(e){r._data=e,a.remove(),r.trigger(Galleria.DATA),o.options.complete.call(o,e)}),o[s[0]].apply(o,f)}else n.apply(this,i)}})(jQuery);