(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["jquery","underscore","backbone","localstorage"],function(e,n,r,i){var s,o,u;return window.dispatch=n.extend(r.Events),u={},o=function(){function e(e,t){t==null&&(t=!1),this.register(e,t)}return e.dispatch=window.dispatch,e.container=e.dispatch,e.bind=function(t,n){return e.container.on(t,n)},e.trigger=function(t,n){return e.container.trigger(t,n)},e.prototype.register=function(e,t){var r;return t==null&&(t=!1),Array.isArray(e)?(n.each(e,function(e){return r=new u[e](t)}),!0):(r=new u[e](t),!0)},e}.call(this),s=function(){function e(e){this.bind(e)}return e.dispatch=window.dispatch,e.prototype.bind=function(t){return t&&(this.eventName=""+this.eventName+":"+t),this.clear(),e.dispatch.on(this.eventName,this.callback)},e.prototype.clear=function(t){var n;return n=t||this.eventName,Logger.log("Clear Dispatch: "+n),e.dispatch.off(n),Logger.log("Bundler event : "+n+", callback:"+this.callback)},e.prototype.callback=function(t,n,r){n==null&&(n=null),r==null&&(r=null),e.dispatch.trigger("store:change:"+t.memo.type+":"+t.memo.namespace,t.response,t.memo.namespace);if(n!=null)return r=r||this,n.call(r)},e}(),u.WebSocketOpen=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="WebSocketOpen",n.prototype.callback=function(e){return Logger.log(""+new Date+" Web Socket Connection is open in "+e.getUri()+" from "+e.getName()),wfwsocket.status={code:1,msg:"online"},s.dispatch.trigger("socket:open"),wfwsocket.sendMessage("getUserInfo")},n}(s),u.GetSessionToken=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getSessionToken",n.prototype.callback=function(e){var t;return t=new i("nc_session_token"),t.data=e.response.sessionToken,t.save()},n}(s),u.GetUserInfo=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getUserInfo",n.prototype.callback=function(e){var t;return console.log("callback getUserInfo"),t=new i("nc_user_info"),t.data=e.response,t.save(),s.dispatch.trigger("user:info:save",e)},n}(s),u.GetPosts=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getPosts",n}(s),u.GetAttachments=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getAttachments",n}(s),u.GetCollections=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getCollections",n}(s),u.GetCalendar=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.eventName="getCalendarEntries",n}(s),u.SubscribeEvent=function(e){function n(e){this.target=e,this.bind(this.target)}return t(n,e),n.prototype.eventName="subscribeEvent",n.prototype.bind=function(e){var t;return t=""+this.eventName+":"+e,this.clear(t),s.dispatch.on(t,this.callback,this)},n.prototype.callback=function(e){var t;return e.memo.event_id&&(t=e.memo.event_id)?s.dispatch.trigger("subscribe:change:"+t+":"+this.target,e.response,e.memo.namespace):s.dispatch.trigger("subscribe:change:"+this.target,e.response,e.memo.namespace)},n}(s),o})}).call(this);