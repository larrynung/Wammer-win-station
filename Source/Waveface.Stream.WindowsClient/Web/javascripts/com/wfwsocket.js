(function(){define(["common","eventbundler"],function(e,t){var n,r,i,s;return i=window,r=i.wfwsocket,n=function(){function n(){}return n.URI="127.0.0.1",n.PORT="1337",n.connection=!1,n.wantTrigger=!0,n.wantShowReceivedData=!1,n.inSandbox=!1,n.init=function(r){return new t(["WebSocketOpen","GetUserInfo"]),n.connection=new WebSocket("ws://"+n.URI+":"+n.PORT+"/"),n.connection.onopen=function(){n.handleOpen(e.Env);if(typeof r=="function")return r()},n.connection.onclose=n.end,n.connection.onmessage=n.handleMessage,n},n.handleOpen=function(e){return t.trigger("WebSocketOpen",e)},n.handleMessage=function(e){var r,i;(n.wantShowReceivedData||n.inSandbox)&&Logger.log("ws received message: "+e.data),r=JSON.parse(e.data),Logger.log("ws received command: "+r.command),!r.memo||Logger.log("ws received memo: "+JSON.stringify(r.memo));if(r.memo!=null){i=[r.command],!r.memo.namespace||i.push(":"+r.memo.namespace),!r.memo.page||i.push(":"+r.memo.page),i=i.join("");if(n.wantTrigger&&!n.inSandbox)return t.trigger(i,r)}else if(n.wantTrigger&&!n.inSandbox)return t.trigger(r.command,r)},n.handleError=function(e){return Logger.log("Something is wrong: "+e)},n.sendMessage=function(e,t,r){var i,s;return r==null&&(r=!1),i={command:e,params:t,memo:r},s=JSON.stringify(i),Logger.log("send msg is "+s),n.connection.send(s)},n.end=function(){return Logger.log("Connector end")},n}.call(this),Backbone.sync=function(e,t,n){return n.success(!0)},n.noconflic=function(){return i.wfwsocket=r,this},s=i.wfwsocket=n})}).call(this);