(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","models/calendar","localstorage","eventbundler","moment"],function(e,n,r,i,s,o){var u;return u=function(n){function u(){return u.__super__.constructor.apply(this,arguments)}return t(u,n),u.prototype.model=r,u.prototype.schemaName="calendars",u.prototype.localStorage=new i("calendars"),u.prototype.initialize=function(){return dispatch.on("store:change:"+this.schemaName+":all",this.updateCalendar,this)},u.prototype.updateCalendar=function(t,n){var r,i=this;return r=t.calendar_entries,e.each(r,function(e){return i.add(e)}),dispatch.trigger("render:change:"+this.schemaName+":"+n,t.calendars)},u.prototype.callCalendar=function(e){var t,n;return e==null&&(e="all"),new s("GetCalendar",e),t={namespace:e,type:this.schemaName},n={group_by:0,page_size:100},wfwsocket.sendMessage("getCalendarEntries",n,t)},u.prototype.photosByDate=function(e){var t,n;return e?(e=o(e,"YYYY-M-D").format("YYYY-MM-DD"),n=this.get(e),n?(t=n.get("attachment_count"),t):0):0},u.prototype.eventsByDate=function(e){var t,n;return e?(e=o(e,"YYYY-M-D").format("YYYY-MM-DD"),t=this.get(e),t?(n=t.get("post_count"),n):0):0},u}(n.Collection),new u})}).call(this);