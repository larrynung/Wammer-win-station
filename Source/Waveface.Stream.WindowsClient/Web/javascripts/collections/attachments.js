(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","models/attachment","localstorage","eventbundler"],function(e,n,r,i,s){var o;return o=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return t(o,n),o.prototype.model=r,o.prototype.schemaName="attachments",o.prototype.dateGroup=[],o.prototype.localStorage=new i("attachments"),o.prototype.initialize=function(){return dispatch.on("store:change:attachment:all",this.updateAttachment,this),dispatch.on("more:attach:bylength",this.loadByLength,this)},o.prototype.updateAttachment=function(t,n){var r,i,s=this;r=t.attachments,i=!1;if(r.length<=0)return!1;e.each(r,function(e,t){var n;return n=moment(e.timestamp).format("YYYY-MM-DD"),t===0&&(i=n),s.dateGroup.push(n),s.add(e)}),this.dateGroup=e.uniq(this.dateGroup);if(n!=="all")return dispatch.trigger("render:change:attachment:"+n,r)},o.prototype.callAttachments=function(e,t,n,r,i){var o,u;return e==null&&(e=!1),t==null&&(t=200),n==null&&(n="all"),u={page_size:t,type:1024},new s("GetAttachments",n),!e||(u.post_id_array=e),!!r&&!!i&&(dispatch.off("store:change:attachment:"+n),dispatch.off("render:change:attachment:"+n),dispatch.on("render:change:attachment:"+n,r,i),dispatch.on("store:change:attachment:"+n,this.updateAttachment,this)),o={namespace:n},wfwsocket.sendMessage("getAttachments",u,o)},o.prototype.filterByDate=function(t){return t?e(this.filter(function(e){var n;return n=e.get("dateUri"),n===t})):this},o.prototype.nextDate=function(t){var n;return n=e.indexOf(this.dateGroup,t),this.dateGroup[n-1]},o.prototype.previousDate=function(t){var n;return n=e.indexOf(this.dateGroup,t),this.dateGroup[n+3]||dispatch.trigger("more:attach:bylength"),this.dateGroup[n+1]},o.prototype.loadMore=function(e,t){var n,r,s,o;return e==null&&(e=100),t==null&&(t=2),s=new i("nc_photos_view_data"),o=s.data,!o.pageSize||!o.pageNo?o=s.data={pageSize:e,pageNo:t}:(e=o.pageSize,t=o.pageNo+=1,s.data=o),s.save(),r={page_size:e,page_no:t},n={namespace:"all"},wfwsocket.sendMessage("getAttachments",r,n)},o}(n.Collection),{loadByLength:function(e){var t,n,r,i;return e==null&&(e=200),t=this.length,r=parseInt(t/e),i={page_size:e,page_no:r+1},n={namespace:"all"},wfwsocket.sendMessage("getAttachments",i,n)}},new o})}).call(this);