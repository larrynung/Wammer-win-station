(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","models/attachment","localstorage","com/subscriber","modules/attachment_caller","global"],function(e,n,r,i,s,o){var u;return u=function(n){function s(){return s.__super__.constructor.apply(this,arguments)}return t(s,n),s.mixin(o),s.prototype.type=s.TYPE_PHOTO,s.prototype.model=r,s.prototype.schemaName="photo",s.prototype.dateGroup=[],s.prototype.localStorage=new i("attachments"),s.prototype.initialize=function(){return dispatch.on("store:change:"+this.schemaName+":all",this.updateAttachment,this),dispatch.on("more:"+this.schemaName+":bylength",this.loadByLength,this),!0},s.prototype.comparator=function(e){return-moment(e.get("timestamp")).unix()},s.prototype.filterByDate=function(t){return t?e(this.filter(function(e){var n;return n=e.get("dateUri"),n===t})):this},s.prototype.nextDate=function(t){var n;return n=e.indexOf(this.dateGroup,t),this.dateGroup[n-1]},s.prototype.previousDate=function(t){var n;return n=e.indexOf(this.dateGroup,t),this.dateGroup[n+3]||dispatch.trigger("more:"+this.schemaName+":bylength"),this.dateGroup[n+1]},s.prototype.loadMore=function(e,t){var n,r,s,o;return e==null&&(e=100),t==null&&(t=2),s=new i("nc_photos_view_data"),o=s.data,!o.pageSize||!o.pageNo?o=s.data={pageSize:e,pageNo:t}:(e=o.pageSize,t=o.pageNo+=1,s.data=o),s.save(),r={page_size:e,page_no:t,type:this.type},n={namespace:"all"},wfwsocket.sendMessage("getAttachments",r,n)},s.prototype.loadByLength=function(e){var t,n,r,i;return e==null&&(e=100),t=this.length,r=parseInt(t/e),i={page_size:e,page_no:r+1,type:this.type},n={namespace:"all",type:this.schemaName},wfwsocket.sendMessage("getAttachments",i,n)},s}(n.Collection),new u})}).call(this);