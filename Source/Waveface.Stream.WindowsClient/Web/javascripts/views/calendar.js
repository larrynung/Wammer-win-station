(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","mustache","collections/events","collections/attachments","collections/calendar","text!templates/calendar.html","lib/d3"],function(e,n,r,i,s,o,u,a){var f;return f=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.id="calendar",n.prototype.eventsCollection=i,n.prototype.photosCollection=s,n.prototype.events={"click #calendar-control .events":"renderEvents","click #calendar-control .photos":"renderPhotos"},n.prototype.initialize=function(){},n.prototype.render=function(){return this.photoDays=this.testData(),this.$el.html(r.render(u)),Mousetrap.reset(),this.delegateEvents(),this},n.prototype.renderCalendar=function(){return this.renderTable()},n.prototype.renderTable=function(){return this.dateRow=a.select(".month tbody").selectAll("tr").data(this.photoDays).enter().append("tr"),this.dateRow.append("th").text(function(e){return e.month_i18n}),this.dateCell=this.dateRow.selectAll("td").data(function(e){return e.day}).enter().append("td").attr("class",function(e){var t;if((t=moment(e.date,"YYYY-M-D").format("d"))==="0"||t==="6")return"holiday"}).text(function(e,t){if(t<moment(e.date,"YYYY-M").daysInMonth())return t+1}).append("div").attr("class","dateCell").append("svg").attr("width","100").attr("height","100"),this.dateLink=this.dateCell.append("a"),this.rects=this.dateLink.append("rect").attr("width","100%").attr("x","0").attr("y","100"),this.renderEvents(),this.dateRow.append("td"),this},n.prototype.renderPhotos=function(){var e=this;return this.$("#calendar-control .btn").removeClass("active"),this.$("#calendar-control .photos").addClass("active"),this.dateLink.attr("xlink:href",function(e){return"#photos/"+e.date}),this.rects.transition().duration(500).attr("class","photo-rect").attr("height",function(t){return""+e.photoBarHeight(t.photo_count)+"%"}).attr("y",function(t){return""+(100-e.photoBarHeight(t.photo_count))+"%"})},n.prototype.renderEvents=function(){var e=this;return this.$("#calendar-control .btn").removeClass("active"),this.$("#calendar-control .events").addClass("active"),this.dateLink.attr("xlink:href",function(e){return"#events/"+e.date}),this.rects.transition().duration(500).attr("class","event-rect").attr("height",function(t){return""+e.eventBarHeight(t.event_count)+"%"}).attr("y",function(t){return""+(100-e.eventBarHeight(t.event_count))+"%"})},n.prototype.eventBarHeight=function(e){var t;return e===0?0:(t=e*10+10,t>100&&(t=100),t)},n.prototype.photoBarHeight=function(e){var t;return e===0?0:(t=e+10,t>100&&(t=100),t)},n.prototype.testData=function(){var e,t,n,r,i,s;e=[];for(r=i=0;i<=11;r=++i){e[r]={month:"2012-"+(r+1),month_i18n:moment().month(r).format("MMM"),day:[]};for(n=s=0;s<=30;n=++s)t="2012-"+(r+1)+"-"+(n+1),e[r].day[n]={date:t,photo_count:o.photosByDate(t),event_count:o.eventsByDate(t)}}return e},n}(n.View),new f({collection:i})})}).call(this);