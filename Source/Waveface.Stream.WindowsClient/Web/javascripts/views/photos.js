(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","views/layouts/day_view","mustache","views/partials/attachment","views/partials/photo_grid","views/gallery","collections/attachments","text!templates/photos.html","bootstrap","jqueryui"],function(e,n,r,i,s,o,u,a){var f;return f=function(n){function u(){return u.__super__.constructor.apply(this,arguments)}return t(u,n),u.prototype.id="photos",u.prototype.initialize=function(){return this.selectedPhotoId=[]},u.prototype.render=function(t){var n,i;return dispatch.on("render:change:attachment:all",this.render,this),this.mode="photo",this.date=t,this.setDates(),n={currentDate:this.currentDate,nextDate:this.nextDate,previousDate:this.previousDate},this.$el.html(r.render(a,n)),i=this.collection.filterByDate(t),this.renderPhotoGrid(i),this.delegateEvents(e.extend(this.events,{"dblclick .frame":this.initGallery,"click .action-new-collection":this.newCollection,"click .action-add-collection":this.addToCollection,"click .action-delete-photo":this.deletePhoto,"click .start-edit":this.startEdit,"click .done-edit":this.doneEdit})),this.initSelectable(),this.setHeaderStyle(),this.setKey(),this},u.prototype.renderPhotoGrid=function(e){var t;return e.size()<1?this:(t=new s,t.render(e)&&this.$(".photos").append(t.el),this.renderPhotoGrid(t.photoData))},u.prototype.addOne=function(e){var t;return t=new i({model:e}),this.$(".photos").append(t.render().el)},u.prototype.loadMore=function(){return this.collection.loadMore()},u.prototype.initGallery=function(e){var t,n;return this.collection?(n=this.$(".frame").index(e.currentTarget),t=this.collection.filterByDate(this.date).map(function(e){return{thumb:e.get("image_meta").small.url,image:e.get("image_meta").medium.url}}),o.render(t,e,n)):!1},u.prototype.startEdit=function(){return this.$(".start-edit-buttons").hide(),this.$(".edit-buttons").show(),this.$selectable.selectable("enable")},u.prototype.doneEdit=function(){return this.$(".start-edit-buttons").show(),this.$(".edit-buttons").hide(),this.$selectable.selectable("disable"),this.$selectable.find(".ui-selected").removeClass("ui-selected")},u.prototype.initSelectable=function(){var t=this;return this.$selectable=this.$(".photo-grid").selectable({appendTo:"#client",filter:".frame",disabled:"true",selected:function(e,n){return t.selectedPhotoId.push(t.$(n.selected).data("id"))},unselected:function(n,r){return t.selectedPhotoId=e.without(t.selectedPhotoId,t.$(r.unselected).data("id"))},start:function(){return t.$(".btn-group").removeClass("open").find(".btn").blur()}})},u.prototype.newCollection=function(e){e.preventDefault();if(this.selectedPhotoId.length>0)return console.log(1e4,"CREATE NEW COLLECTION"),console.log(10001,"ADD THESE TO THE NEW COLECTION!!!",this.selectedPhotoId),console.log(10002,"GO TO THE COLLECTION PAGE")},u.prototype.addToCollection=function(e){e.preventDefault();if(this.selectedPhotoId.length>0)return console.log(1e4,"ADD THESE TO COLECTION!!!",this.selectedPhotoId)},u.prototype.deletePhoto=function(e){e.preventDefault();if(this.selectedPhotoId.length>0)return console.log(1e4,"DELETE THESE PHOTOS!!!",this.selectedPhotoId)},u.prototype.setKey=function(){var e=this;return Mousetrap.reset(),Mousetrap.bind("right",function(){return e.nextPage(),!1}),Mousetrap.bind("left",function(){return e.previousPage(),!1}),Mousetrap.bind("c",function(){return e.calendarSwitch(),!1})},u.prototype.calendarSwitch=function(){var t,n,r=this;if(this.mode==="calendar")return this.render(this.date);if(this.mode==="photo")return n=this.collection.map(function(e){return{start:e.get("dateUri"),title:"Photo",allDay:!0,backgroundColor:"#6E93AA",borderColor:"#6E93AA"}}),n=e.uniq(n,!1,function(e){return e.start}),t={events:n,year:this.currentYear,month:this.currentMonth,header:!1,height:$("#main").height()-100,eventClick:function(e){return Router.navigate("photos/"+moment(e.start).format("YYYY-MM-DD"),{trigger:!0})},viewDisplay:function(e){return r.updateHeaderDate(e.title)}},this.renderCalendar(t)},u}(n),new f({collection:u})})}).call(this);