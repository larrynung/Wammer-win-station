(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","views/layouts/day_view","mustache","mousetrap","views/event_sum","views/event_detail","collections/events","text!templates/events.html","localstorage"],function(e,n,r,i,s,o,u,a,f){var l;return l=function(n){function u(){return u.__super__.constructor.apply(this,arguments)}return t(u,n),u.prototype.id="events",u.prototype.eventView=[],u.prototype.initialize=function(){},u.prototype.render=function(e,t){var n,i,s=this;return this.mode="event",this.date=e,t!=null&&(i=this.collection.get(t),i!=null&&(this.currentEvent=i,this.date=this.currentEvent.get("dateUri"))),this.setDates(),n={currentDate:this.currentDate,nextDate:this.nextDate,previousDate:this.previousDate},this.$el.html(r.render(a,n)),this.collection.filterByDate(this.date).each(function(e,t){return s.addOne(e,t)}),this.delegateEvents(),this.setHeaderStyle(),this.setKey(),i!=null&&this.eventSelect(i),this},u.prototype.addOne=function(e,t){this.eventView[e.id]=new s({model:e}),this.eventView[e.id].on("eventSelect",this.eventSelect,this),this.$("#event-list").append(this.eventView[e.id].render().el);if(t===0)return this.eventSelect(e)},u.prototype.eventSelect=function(e){return e?(this.currentEvent=e,this.renderCurrentEvent()):!1},u.prototype.renderCurrentEvent=function(){var e,t;return this.currentEvent?(this.eventDetailView!=null&&(this.eventDetailView.remove(),this.eventDetailView.model.off(),Logger.log("KILL Zombie")),this.eventDetailView=new o({model:this.currentEvent}),e=this,this.$("#event-detail-col").fadeOut("fast",function(){return $(this).empty().append(e.eventDetailView.render().el).fadeIn("fast")}),this.$(".event").removeClass("selected"),this.eventView[this.currentEvent.id].$el.addClass("selected"),t=new f("nc_view_state:events"),t.data={date:this.date,id:this.currentEvent.id},t.save(),Router.navigate("events/"+this.date+"/"+this.currentEvent.id)):!1},u.prototype.nextEvent=function(){var e;e=this.collection.nextEvent(this.currentEvent.id);if(!e)return!1;if(e.get("dateUri")===this.date)return this.eventSelect(e)},u.prototype.previousEvent=function(){var e;e=this.collection.previousEvent(this.currentEvent.id);if(!e)return!1;if(e.get("dateUri")===this.date)return this.eventSelect(e)},u.prototype.calendarSwitch=function(){var t,n,r=this;if(this.mode==="calendar")return this.render(this.date);if(this.mode==="event")return n=this.collection.map(function(e){return{start:e.get("dateUri"),title:"Events"}}),n=e.uniq(n,!1,function(e){return e.start}),t={events:n,year:this.currentYear,month:this.currentMonth,header:!1,eventClick:function(e){return Router.navigate("events/"+moment(e.start).format("YYYY-MM-DD"),{trigger:!0})},viewDisplay:function(e){return r.updateHeaderDate(e.title)}},this.renderCalendar(t)},u.prototype.setKey=function(){var e=this;return i.reset(),i.bind("right",function(){return e.nextPage(),!1}),i.bind("left",function(){return e.previousPage(),!1}),i.bind("up",function(){return e.nextEvent(),!1}),i.bind("down",function(){return e.previousEvent(),!1}),i.bind("c",function(){return e.calendarSwitch(),!1})},u}(n),new l({collection:u})})}).call(this);