(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","mustache","views/partials/attachment","views/gallery","collections/attachments","text!templates/partials/event_detail.html","googlemaps"],function(e,n,r,i,s,o,u){var a;return a=function(n){function a(){return a.__super__.constructor.apply(this,arguments)}return t(a,n),a.prototype.className="event-detail",a.prototype.events={"click .attachment":"startGallery"},a.prototype.render=function(){return this.model?(this.$el.html(r.render(u,this.model.toJSON())),this.$el.addClass("event-type-"+this.model.get("type")),this.model.detailFetchStatus||(o.callAttachments([this.model.id],100,this.model.id,this.renderAttachments,this),this.model.detailFetchStatus=!0),this.photoViews=[],this.renderLocalAttachments(this.model.get("attachment_id_array")),this.delegateEvents(),this):!1},a.prototype.renderAttachments=function(t,n){var r=this;return this.photos=t,this.$(".attachments").empty(),e.each(t,function(e){var t,n;if(!!(t=o.get(e.id)))return n=new i({model:t}),r.$(".attachments").append(n.render().el),r.photoViews.push(n)})},a.prototype.renderLocalAttachments=function(t){var n=this;return this.photos=t,t.length<=0?!1:(this.$(".attachments").empty(),e.each(t,function(e){var t,r;if(!!(t=o.get(e)))return r=new i({model:t}),n.$(".attachments").append(r.render().el),n.photoViews.push(r)}))},a.prototype.renderMap=function(){var e,t,n,r,i;if(this.model.get("hasMap")===!0&&navigator.onLine===!0)return e=this.$("#map_canvas").get(0),t=this.model.get("gps"),n=new google.maps.LatLng(t.latitude,t.longitude),r={center:n,zoom:t.zoom_level,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},this.map=new google.maps.Map(e,r),i=new google.maps.Marker({position:n,map:this.map})},a.prototype.loadMore=function(){return this.collection.loadMore()},a.prototype.startGallery=function(t){var n;return this.photos!=null?(n=e(this.photos).map(function(e){var t,n;e.id!=null?n=o.get(e.id):o.get(e)&&(n=o.get(e)),t=n.get("meta_data");if(t&&t.small.url!=null&&t.medium.url!=null)return{thumb:t.small.url,image:t.medium.url}}),s.render(n,t)):!1},a}(n.View)})}).call(this);