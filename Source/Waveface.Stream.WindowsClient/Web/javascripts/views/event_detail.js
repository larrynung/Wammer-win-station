(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","mustache","views/partials/attachment","views/gallery","collections/attachments","text!templates/event_detail.html","googlemaps"],function(e,n,r,i,s,o,u){var a;return a=function(n){function a(){return a.__super__.constructor.apply(this,arguments)}return t(a,n),a.prototype.id="event-detail",a.prototype.events={"click .attachment":"startGallery"},a.prototype.render=function(){return this.model?(this.$el.html(r.render(u,this.model.toJSON())),this.$el.addClass("event-type-"+this.model.get("type")),o.callAttachments([this.model.id],100,this.model.id,this.renderAttachments,this),this):!1},a.prototype.renderAttachments=function(t){var n,r=this;return this.photos=t,n=Math.floor(this.$(".attachments").width()*.2),e.each(t,function(e){var t,s;if(!!(t=o.get(e.id)))return s=new i({model:t,width:n,height:n}),r.$(".attachments").append(s.render().el)}),this.model.get("hasMap")===!0?this.renderMap():this.$("#map_canvas").remove()},a.prototype.renderMap=function(){var e,t,n,r,i;return e=this.model.get("gps"),t=new google.maps.LatLng(e.latitude,e.longitude),r={center:t,zoom:e.zoom_level,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},n=new google.maps.Map(document.getElementById("map_canvas"),r),i=new google.maps.Marker({position:t,map:n})},a.prototype.loadMore=function(){return this.collection.loadMore()},a.prototype.startGallery=function(t){var n;return this.photos?(n=e(this.photos).map(function(e){if(e.image_meta.small.url!=null&&e.image_meta.medium.url!=null)return{thumb:e.image_meta.small.url,image:e.image_meta.medium.url}}),s.render(n,t)):!1},a}(n.View)})}).call(this);